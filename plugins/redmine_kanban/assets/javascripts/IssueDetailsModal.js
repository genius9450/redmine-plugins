import{f as w,u as j,a as E,r as m,g as S,j as M,o as a,c as l,w as V,b as t,d as y,k as b,F as I,t as x,l as N,m as i,n as L,v as R,e as r,E as A,p as F,q as G}from"./ModalsView.js";import H from"./AttachmentItem.js";import{_ as J}from"./IssueDetailsHeader.vue_vue_type_script_setup_true_lang.js";import K from"./IssueDetailsContent.js";import{_ as O}from"./IssueDetailsComments.vue_vue_type_script_setup_true_lang.js";/* empty css                          */import{_ as T}from"./IssueDetailsWatchers.vue_vue_type_script_setup_true_lang.js";import"./FormatDates.js";import"./linkTo.js";import"./ChipPrimitive.vue_vue_type_script_setup_true_lang.js";const z={class:"modal-issue__content"},P=t("hr",{class:"mb-16"},null,-1),Q={class:"modal-issue--body"},U={class:"modal-issue--content-wrapper c-scroll pr-8"},W=t("hr",{class:"mb-16"},null,-1),X=t("hr",{class:"mb-16"},null,-1),Y={id:"checklists",class:"w-100"},ue={__name:"IssueDetailsModal",props:{isActive:{type:Boolean,default:!1},modalData:{required:!0,validator(n){return typeof n=="object"||n===null}}},setup(n){const h=n,$=w("components/IssueRelations/IssueRelations.enterprise"),C=w("components/IssueChildren/IssueChildren.enterprise"),_=j(),{emitGlobalEvent:D}=G(),{closeModal:v}=E(),e=m(null),p=m(!1),B=m(0);async function u(){try{p.value=!1;const s=await _.getIssueById(h.modalData.issue_id);s?(e.value=s,window.issue=s,window.checklists_settings=JSON.stringify({question_lists_can_add:(s==null?void 0:s.question_lists_can_add)??!1,question_lists_can_add_visa:(s==null?void 0:s.question_lists_can_add_visa)??!1}),p.value=!0):v(h.modalData.template)}catch(s){console.error(s)}}function q(){F().then(()=>{D("initChecklist")})}return S(()=>{u()}),M(()=>_.issues,()=>{u()}),(s,o)=>(a(),l(r(A),{"is-active":n.isActive,"is-data-loaded":!!e.value,class:"modal-issue","transition-name":"modal-fade","content-transition":"modal-content",onClose:o[1]||(o[1]=c=>r(v)(n.modalData.template))},{default:V(()=>{var c,f,g,k;return[t("div",z,[y(J,{issue:e.value},null,8,["issue"]),P,t("div",Q,[t("div",U,[y(K,{issue:e.value},null,8,["issue"]),e.value.attachments&&e.value.attachments.length?(a(),b(I,{key:0},[W,t("h3",null,x(s.$t("label_attachment_plural")),1),(a(!0),b(I,null,N(e.value.attachments,d=>(a(),l(H,{key:d.id,"is-issue-type":"","target-id":e.value.id,file:d,onChange:u},null,8,["target-id","file"]))),128))],64)):i("",!0),X,L(t("div",Y,[t("img",{src:"",onError:o[0]||(o[0]=d=>q())},null,32)],512),[[R,!!e.value.question_lists]]),(c=e.value.watchers)!=null&&c.length?(a(),l(T,{key:1,watchers:e.value.watchers},null,8,["watchers"])):i("",!0),(f=e.value.children)!=null&&f.length&&s.$appVersion==="enterprise"?(a(),l(r(C),{key:2,children:e.value.children},null,8,["children"])):i("",!0),(g=e.value.relations)!=null&&g.length&&s.$appVersion==="enterprise"?(a(),l(r($),{key:3,issue:e.value},null,8,["issue"])):i("",!0)]),(k=e.value.journals)!=null&&k.length?(a(),l(O,{key:0,journals:e.value.journals,"max-height":B.value,class:"modal-issue--comments"},null,8,["journals","max-height"])):i("",!0)])])]}),_:1},8,["is-active","is-data-loaded"]))}};export{ue as default};
