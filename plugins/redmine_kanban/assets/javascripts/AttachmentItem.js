import{D,G as L,r as T,H as C,I as y,g as H,J as V,o as u,k as d,b as s,t as c,e as i,F as x,K as I,m as p,n as B,v as G,L as k,d as _,w as R,C as $,h as S,V as U,M as A}from"./ModalsView.js";import{u as P}from"./FormatDates.js";/* empty css                          */const v={FILE_NAME_LENGTH:10,MAX_FILE_NAME_LENGTH:25,DESCRIPTION_MAX_LENGTH:50,ERROR_TYPES:{MAX_SIZE:"maxFileSizeError",FILE_TYPE:"fileTypeError"}},X={BAD_REQUEST:500},O=["b","kb","mb","gb"],j=(a=0)=>{let o=0,n=parseInt(a.toString(),10)||0;for(;n>=1024&&++o;)n=n/1024;return`${n.toFixed(n<10&&o>0?1:0)} ${O[o]}`},q=({string:a,maxLength:o,sliceLength:n})=>{if(a.length<o)return a;const m=a.slice(0,n),E=a.slice(-n);return`${m}...${E}`};function z(a){return q({string:a,maxLength:v.MAX_FILE_NAME_LENGTH,sliceLength:v.FILE_NAME_LENGTH})}const K={class:"attachments__item max-w-550"},Q={class:"flex items-center flex-wrap justify-between"},Y={class:"flex gap-8"},J=s("span",{class:"attachments__item__icon"},null,-1),Z=["href","title"],W={class:"attachments__item__size"},ee=["href","title"],te={class:"flex gap-8"},ae={class:"attachments__item__author"},ne=["title"],se=["title"],le={class:"mt-4"},ie={class:"text-priority_1"},oe={key:0,class:"relative"},ce=s("br",null,null,-1),re={class:"flex justify-end gap-12"},me={__name:"AttachmentItem",props:{file:{type:Object,required:!0},targetId:{type:[String,Number],required:!0},isIssueType:{type:Boolean,default:()=>!1},locked:{type:Boolean,default:()=>!1}},emits:["change"],setup(a,{emit:o}){const n=a,m=D(),{t:E}=L(),{humanDate:N}=P(),r=T(!1),f=T(""),h=T(""),g=C(()=>n.isIssueType?y.ATTACHMENTS.ISSUE:y.ATTACHMENTS.TASK);function w(e){return`/attachments/download/${e.id}/${e.filename}`}function b(){const{description:e,filename:t}=n.file;f.value=e??"",h.value=t??"",r.value=!1}async function F(e){try{const t=g.value.DELETE({id:e.id}),l=new FormData;l.append("_method","delete"),l.append("authenticity_token",m.token),await A.post(t,l),o("change")}catch(t){console.error(t)}}async function M(){try{const e=g.value.EDIT({id:n.targetId}),t=new FormData;t.append("utf8","âœ“"),t.append("_method","patch"),t.append("authenticity_token",n.token),t.append("commit",E("button_save")),t.append(`attachments[${n.file.id}][filename]`,h.value),t.append(`attachments[${n.file.id}][description]`,f.value),t.append("back_url",`/issues/${n.isIssueType?n.targetId:n.issueId}`),await A.post(e,t),o("change"),r.value=!1}catch(e){e.response.status===X.BAD_REQUEST?(o("change"),r.value=!1):(console.error(e),b())}}return H(()=>{b()}),V(()=>{var e;m.setToken(((e=document.querySelector("meta[name='csrf-token']"))==null?void 0:e.getAttribute("content"))??null)}),(e,t)=>(u(),d("div",K,[s("div",Q,[s("div",Y,[J,s("a",{href:`/attachments/${a.file.id}`,target:"_blank",rel:"noopener noreferrer",class:"attachments__item__link",title:a.file.filename},c(i(z)(a.file.filename)),9,Z),s("span",W,"("+c(i(j)(a.file.filesize))+")",1),s("a",{href:w(a.file),download:"",target:"_blank",title:e.$t("button_download"),class:"attachments__item__action attachments__item__action--download"},null,8,ee)]),s("div",te,[s("span",ae,c(a.file.author.name)+", "+c(i(N)(a.file.created_on)),1),a.locked?p("",!0):(u(),d(x,{key:0},[a.isIssueType?p("",!0):(u(),d("button",{key:0,class:"attachments__item__action attachments__item__action--remove",title:e.$t("button_delete"),onClick:t[0]||(t[0]=I(l=>F(a.file),["prevent"]))},null,8,ne)),a.isIssueType?p("",!0):(u(),d("button",{key:1,class:"attachments__item__action attachments__item__action--edit",title:e.$t("button_edit"),onClick:t[1]||(t[1]=I(l=>r.value=!0,["prevent"]))},null,8,se))],64))])]),B(s("p",le,[s("span",ie,c(e.$t("field_description"))+": ",1),k(" "+c(a.file.description),1)],512),[[G,a.file.description]]),r.value?(u(),d("div",oe,[_(i(U),{"is-active":r.value,class:"attachments__hint max-w-260 flex flex-column gap-12","onUpdate:isActive":t[4]||(t[4]=l=>r.value=!1)},{default:R(()=>[s("h4",null,[s("b",null,c(e.$t("label_edit_attachments"))+":",1),ce,k(c(a.file.filename),1)]),_(i($),{modelValue:h.value,"onUpdate:modelValue":t[2]||(t[2]=l=>h.value=l),maxlength:i(v).MAX_FILE_NAME_LENGTH*2,"is-autofocus":!1,placeholder:e.$t("field_description"),label:e.$t("field_description"),class:"attachments__hint__input"},null,8,["modelValue","maxlength","placeholder","label"]),_(i($),{modelValue:f.value,"onUpdate:modelValue":t[3]||(t[3]=l=>f.value=l),maxlength:i(v).DESCRIPTION_MAX_LENGTH,"is-autofocus":!1,placeholder:e.$t("field_filename"),label:e.$t("field_filename"),class:"attachments__hint__input"},null,8,["modelValue","maxlength","placeholder","label"]),s("div",re,[_(i(S),{class:"attachments__hint__action attachments__hint__action--save",label:e.$t("button_save"),title:e.$t("button_save"),onClick:M},null,8,["label","title"]),_(i(S),{class:"attachments__hint__action attachments__hint__action--cancel",label:e.$t("button_cancel"),title:e.$t("button_cancel"),onClick:b},null,8,["label","title"])])]),_:1},8,["is-active"])])):p("",!0)]))}};export{me as default};
