import{y as W,f as Y,a3 as Z,a0 as x,a as ee,H as D,a7 as te,o as t,k as a,P as c,b as o,t as i,m as n,F as k,l as b,L as T,c as E,e as u,Q as O,$ as ae,K as N,d as $,w as se,a8 as ne,a9 as ie,X as oe}from"./ModalsView.js";import{u as le}from"./FormatDates.js";import{_ as w}from"./ChipPrimitive.vue_vue_type_script_setup_true_lang.js";/* empty css                          */const m={ID:"id",PROJECT:"project",TRACKER:"tracker",PARENT:"parent",PRIORITY:"priority",AUTHOR:"author",UPDATED_ON:"updated_on",DUE_DATE:"due_date",TOTAL_ESTIMATED_HOURS:"total_estimated_hours",QUESTIONLIST:"questionlist",SPENT_HOURS:"spent_hours",IS_PRIVATE:"is_private",ASSIGNED_TO:"assigned_to"},re="Usual",P="Assigned",_e="/plugin_assets/redmine_kanban/images/icons/clock.svg",de="/plugin_assets/redmine_kanban/images/icons/calendar.svg",ue=["onClick"],me={key:1},ce={style:{display:"flex"}},ke=["href"],pe={key:1,class:"kanban-item__header__row kanban-item-header flex items-center kanban-item-header__size"},he={class:"kanban-item__header__row kanban-item-header"},De={class:"kanban-item-header__issue-type flex items-center"},be={key:0,class:"kanban-item-header__tracker mr-8"},fe=["href"],ge={key:0,class:"kanban-item-header__spended-time"},ve={class:"kanban-item-header__spended-time time"},ye=["title"],Te=["title"],Ee={class:"kanban-item__header__row mt-4"},Ae={key:0,class:"kanban-item__author"},Se=["title"],Ie={key:2,class:"kanban-item__warning mb-4"},Ue={class:"kanban-item__content"},Re={key:0,class:"kanban-item__project"},Ce={key:1,class:"kanban-item__subject"},Oe={key:2,class:"kanban-item__custom-fields"},Ne={class:"kanban-item__field-value"},$e={key:3,class:"kanban-item-checklists"},we={class:"kanban-item-checklists__item__title"},Pe={key:0,class:"kanban-item-checklists__item__icon checklists__item__icon--assigned"},je={class:"kanban-item-checklists__item__info fz-12 text--bold"},qe={key:1,class:"kanban-item__tags"},Ve={key:2,class:"kanban-item__footer"},Le={class:"kanban-item__due-date__item text-black"},He={key:1,class:"kanban-item__assignet-to"},ze=["href","onClick"],Qe=W({__name:"IssuiesBoardItem",props:{itemData:{},checkedUsers:{default:null},isDragActive:{type:Boolean,default:!1}},setup(j){const l=j,q=Y("components/IssueParent/IssueParent.pro"),V=Z("appVersion")!=="free"?"hascontextmenu":"",L=x(),{createModal:H}=ee(),{diffInDaysToNow:z,diffUpdatedOnClass:B,humanDate:A,dateDistanceToNow:M}=le(),v=D(()=>[m.ID,m.TRACKER,m.SPENT_HOURS,m.AUTHOR,m.TOTAL_ESTIMATED_HOURS,m.UPDATED_ON].some(e=>y(e))),F=D(()=>[m.DUE_DATE,m.ASSIGNED_TO].some(e=>y(e))),S=D(()=>{var r;let e=[];return(r=l.itemData.question_lists)!=null&&r.length&&(e=l.itemData.question_lists.reduce((d,f)=>{var g;return(g=f.assignees)!=null&&g.length&&(d=[...new Set([...d,...f.assignees])]),d},[])),!e.some(d=>l.itemData.assigned_to?d.id===l.itemData.assigned_to.id:!1)&&l.itemData.assigned_to&&(e=[...e,{id:l.itemData.assigned_to.id,name:l.itemData.assigned_to.name,avatar:l.itemData.assigned_to.avatar??null}]),te(e,"id")}),G=D(()=>(l.itemData.due_date?z(l.itemData.due_date):-1)<=1?"due-date--danger":""),I=D(()=>{var e,_;return(_=(e=l.itemData)==null?void 0:e.question_lists)==null?void 0:_.reduce((r,d)=>(Array.isArray(r[d.list_type])||(r[d.list_type]=[]),r[d.list_type].push(d),r),{[P]:[],[re]:[]})}),K=D(()=>{var e,_;return(_=(e=l.itemData)==null?void 0:e.question_lists)==null?void 0:_.find(r=>r.flag_not_all_assigned===!0)});function Q(e){var _;return((_=l.checkedUsers)==null?void 0:_.some(r=>r.id===e))??!1}function X(e){var _;!((_=e.target)!=null&&_.href)&&!l.isDragActive&&(e.preventDefault(),H({template:oe.ISSUE_DETAILS,issue_id:l.itemData.id}))}function y(e){return L.settings.show_card_properties.includes(m[e.toUpperCase()])??!1}function J(e){window.open(`/users/${e}`,"_blank")}return(e,_)=>{var r,d,f,g,U,R,C;return t(),a("div",{class:c(["kanban-item",u(V),(r=e.itemData.priority)!=null&&r.id?`priority_${e.itemData.priority.id}`:"no-priority"]),onClick:N(X,["stop"])},[v.value||e.itemData.block_reason?(t(),a("div",{key:0,class:c(["kanban-item__header",{"m-0":!v.value}])},[o("div",null,[e.itemData.block_reason?(t(),a("div",{key:0,class:c(["kanban-item__block-reason",{"m-0":!v.value}])},[o("span",null,i(e.itemData.block_reason),1)],2)):n("",!0),(d=e.itemData.blocked_by_issues)!=null&&d.length?(t(),a("div",me,[(t(!0),a(k,null,b(e.itemData.blocked_by_issues,(s,p)=>(t(),a("div",{key:p,class:c(["kanban-item__block-reason",{"m-0":!v.value}])},[o("div",ce,[o("span",null,[o("a",{class:"fz-12",href:`/issues/${s.id}`,target:"_blank"}," #"+i(s.id)+"Â  ",9,ke),T(" "+i(s.subject),1)])])],2))),128))])):n("",!0)]),(f=e.itemData.parents)!=null&&f.id&&e.$appVersion!=="free"?(t(),E(u(q),{key:0,parent:e.itemData.parents,"has-tracker":!1,class:"mb-8"},null,8,["parent"])):n("",!0),(g=e.itemData.size)!=null&&g.id?(t(),a("div",pe,i(e.itemData.size.name),1)):n("",!0),o("div",he,[o("div",De,[(U=e.itemData.tracker)!=null&&U.id?(t(),a("span",be,i(e.itemData.tracker.name),1)):n("",!0),y(u(m).ID)?(t(),a("a",{key:1,class:"kanban-item-header__task-number cup",href:`/issues/${e.itemData.id}`,target:"_blank"}," #"+i(e.itemData.id),9,fe)):n("",!0),e.itemData.is_private?(t(),E(w,{key:2,title:e.$t("field_is_private"),class:"ml-8"},null,8,["title"])):n("",!0)]),e.itemData.total_spent_hours||e.itemData.total_estimated_hours?(t(),a("div",ge,[o("span",{class:"kanban-item-header__spended-time icon",style:O({backgroundImage:`url(${u(_e)})`})},null,4),o("div",ve,[e.itemData.total_estimated_hours?(t(),a("span",{key:0,title:e.$t("label_spent_time")+"/"+e.$t("field_total_estimated_hours")},i(e.itemData.total_spent_hours?+e.itemData.total_spent_hours.toFixed(1):0)+" /"+i(+e.itemData.total_estimated_hours.toFixed(1)),9,ye)):(t(),a("span",{key:1,title:e.$t("label_spent_time")},i(+e.itemData.total_spent_hours.toFixed(1)),9,Te))])])):n("",!0)]),o("div",Ee,[e.itemData.author?(t(),a("div",Ae,[o("span",null,i(e.itemData.author),1)])):n("",!0),e.itemData.updated_on&&y(u(m).UPDATED_ON)?(t(),a("div",{key:1,class:c(["kanban-item__updated-at",u(B)(e.itemData.updated_on)]),title:u(A)(e.itemData.updated_on)},i(e.$t("label_updated_time",{value:u(M)(e.itemData.updated_on)})),11,Se)):n("",!0),K.value?(t(),a("div",Ie,i(e.$t("label_checklists_should_be_assigned")),1)):n("",!0)])],2)):n("",!0),o("div",Ue,[(R=e.itemData.project)!=null&&R.id?(t(),a("span",Re,i(e.itemData.project.name),1)):n("",!0),e.itemData.subject?(t(),a("a",Ce,i(e.itemData.subject),1)):n("",!0),e.itemData.custom_fields&&e.itemData.custom_fields.length?(t(),a("div",Oe,[(t(!0),a(k,null,b(e.itemData.custom_fields,s=>(t(),a(k,null,[s.value?(t(),a("span",{key:s.id,class:"kanban-item__field"},[T(i(s.name)+" ",1),o("span",Ne,": "+i(s.value),1)])):n("",!0)],64))),256))])):n("",!0),ae(e.$slots,"default"),I.value?(t(),a("div",$e,[(t(!0),a(k,null,b(Object.entries(I.value),([s,p])=>(t(),a(k,null,[p&&p.length?(t(),a("div",{key:s,class:"kanban-item-checklists__list"},[(t(!0),a(k,null,b(p,h=>(t(),a("div",{key:h.id,class:c(["kanban-item-checklists__item flex justify-between items-center mt-2 mb-2",{completed:h.questions_completed>0&&h.questions_completed===h.questions_total}])},[o("span",we,[s===u(P)?(t(),a("span",Pe)):n("",!0),T(" "+i(h.title),1)]),o("span",je,i(h.questions_completed)+"/"+i(h.questions_total),1)],2))),128))])):n("",!0)],64))),256))])):n("",!0)]),e.itemData.tags&&e.$appVersion!=="free"?(t(),a("div",qe,[(t(!0),a(k,null,b(e.itemData.tags,(s,p)=>(t(),E(w,{key:p,title:s.name,color:s.color||"darkgreen",font:s.font||"black"},null,8,["title","color","font"]))),128))])):n("",!0),F.value?(t(),a("div",Ve,[e.itemData.due_date?(t(),a("div",{key:0,class:c(["kanban-item__due-date",G.value])},[o("span",{class:"kanban-item__due-date__icon",style:O({backgroundImage:`url(${u(de)})`})},null,4),o("span",Le,i(u(A)(e.itemData.due_date,!1)),1)],2)):n("",!0),(C=S.value)!=null&&C.length?(t(),a("div",He,[(t(!0),a(k,null,b(S.value,s=>(t(),a(k,null,[s.id?(t(),a("a",{key:s.id,href:`/users/${s.id}`,class:c(["kanban-item__assignet-to__item"]),target:"_blank",onClick:N(p=>J(s.id),["stop"])},[$(u(ie),{label:s.name,position:"top"},{default:se(()=>[$(u(ne),{label:s.name,avatar:s.avatar||null,small:"",class:c({checked:Q(s.id)})},null,8,["label","avatar","class"])]),_:2},1032,["label"])],8,ze)):n("",!0)],64))),256))])):n("",!0)])):n("",!0)],10,ue)}}});export{Qe as _};
