import{y as P,f as S,u as D,a as N,c8 as E,r as F,H as K,o as t,k as i,c as d,e as a,m as r,b as o,L as m,t as n,d as p,w as c,h as $,a9 as O,Y as y,P as R,K as U,X as Y,F as X,l as q,c9 as A,ai as G}from"./ModalsView.js";import{u as J}from"./FormatDates.js";import{l as Q}from"./linkTo.js";import{_ as W}from"./ChipPrimitive.vue_vue_type_script_setup_true_lang.js";/* empty css                          */const Z="/plugin_assets/redmine_kanban/images/icons/open-icon.svg",x="/plugin_assets/redmine_kanban/images/icons/copy-to-clipboard.svg",ee="/plugin_assets/redmine_kanban/images/icons/close.svg",se={key:0,class:"modal-issue__header"},ae=["href"],oe={class:"flex mb-8"},le={class:"fz-12"},te=["href"],ne=["src"],ie=["src"],re={class:"h1"},ue={key:2,class:"h1"},de={class:"flex justify-between modal-issue__header-info"},ce={class:"flex flex-wrap fz-12"},be=["innerHTML"],_e=o("span",null,". ",-1),pe=["title","innerHTML"],fe={class:"flex items-center"},me=["href"],ke={key:3,class:"flex flex-column fz-12"},he={key:0,class:"modal-issue__header__issue-blocked blocked-by-reason"},ve=["href","title"],ge={class:"block-reason fz-14"},$e={key:1,class:"block-reason fz-14"},ye=["src","alt"],Ce={key:4},we=["href"],Be=P({__name:"IssueDetailsHeader",props:{issue:{default:null}},emits:["updated"],setup(C,{emit:w}){const u=C,j=S("components/IssueParent/IssueParent.pro"),z=D(),{diffUpdatedOnClass:I,dateDistanceToNow:f,humanDate:L}=J(),{createModal:T}=N(),{copy:B,copied:V}=E(),b=F(!1),k=K(()=>u.issue?`${window.location.origin}/issues/${u.issue.id}`:"");function _(e,s){h({[s]:e})}async function h(e){if(!u.issue)return;const s=await z.editIssue({issue_id:u.issue.id,updated_on:u.issue.updated_on,...e});w("updated",s)}function M(){h({block_reason:""}),b.value=!1}return(e,s)=>{var v,g;return e.issue?(t(),i("div",se,[(v=e.issue.parents)!=null&&v.id&&e.$appVersion!=="free"?(t(),d(a(j),{key:0,parent:e.issue.parents},null,8,["parent"])):r("",!0),o("a",{class:"modal-issue__header-project fz-12",href:`/projects/${e.issue.project.id}`,target:"_blank"},[m(n(e.$t("label_project"))+": ",1),o("strong",null,n(e.issue.project.name),1)],8,ae),o("div",oe,[o("span",le,n(e.issue.tracker.name)+"  ",1),o("a",{class:"fz-12",href:k.value,target:"_blank"},[o("img",{src:a(Z),alt:"",style:{height:"8px","margin-left":"4px"}},null,8,ne),m(" #"+n(e.issue.id)+"  ",1)],8,te),p(a(O),{label:e.$t("label_copied"),position:"top",dark:"",dynamic:"",visible:a(V),duration:2e3,class:"ml-12"},{default:c(()=>[p(a($),{flat:"",onClick:s[0]||(s[0]=l=>a(B)(k.value))},{default:c(()=>[o("img",{src:a(x),alt:"",style:{height:"14px"}},null,8,ie)]),_:1})]),_:1},8,["label","visible"]),e.issue.is_private?(t(),d(W,{key:0,title:e.$t("field_is_private"),class:"ml-16"},null,8,["title"])):r("",!0)]),e.$appVersion==="enterprise"?(t(),d(a(y),{key:1,value:e.issue.subject,maxlength:500,"is-auto-grow":!1,"save-label":e.$t("button_save"),"cancel-label":e.$t("button_cancel"),onChange:s[1]||(s[1]=l=>_(l,"subject")),onPressEnter:s[2]||(s[2]=l=>_(l,"subject"))},{default:c(()=>[o("h1",re,n(e.issue.subject),1)]),_:1},8,["value","save-label","cancel-label"])):(t(),i("h1",ue,n(e.issue.subject),1)),o("div",de,[o("div",ce,[o("span",{class:"issue-author",innerHTML:e.$t("label_added_time_by",{author:a(Q)(e.issue.author),age:a(f)(e.issue.created_on)})},null,8,be),_e,o("span",{class:R([a(I)(e.issue.updated_on)]),title:a(L)(e.issue.updated_on),style:{"max-width":"100%"},innerHTML:e.$t("label_updated_time",{value:a(f)(e.issue.updated_on)})},null,10,pe)]),o("div",fe,[e.issue.block_reason?r("",!0):(t(),i("a",{key:0,class:"fz-12 mr-8",href:"",onClick:s[3]||(s[3]=U(l=>{a(T)({template:a(Y).BLOCK_ISSUE,issue:e.issue})},["prevent"]))},n(e.$t("field_block_reason")),1)),o("a",{class:"fz-12",href:`/issues/${e.issue.id}/time_entries/new`,target:"_blank"},n(e.$t("button_log_time")),9,me)])]),e.issue.block_reason?(t(),i("div",ke,[e.issue.blocked_at?(t(),i("div",he,[o("a",{href:`/issues/${e.issue.id}/block-history`,title:e.$t("hint_block_reason")},n(e.$t("label_board_locked")),9,ve),m(" "+n(a(f)(e.issue.blocked_at))+" ",1),e.$appVersion==="enterprise"?(t(),d(a(y),{key:0,value:e.issue.block_reason,maxlength:500,"is-auto-grow":!1,"save-label":e.$t("button_save"),"cancel-label":e.$t("button_cancel"),onChange:s[4]||(s[4]=l=>_(l,"block_reason")),onPressEnter:s[5]||(s[5]=l=>_(l,"block_reason"))},{default:c(()=>[o("div",ge,n(e.issue.block_reason),1)]),_:1},8,["value","save-label","cancel-label"])):(t(),i("div",$e,n(e.issue.block_reason),1)),p(a($),{flat:"",class:"modal-issue__header__issue-blocked-remove",onClick:s[6]||(s[6]=l=>b.value=!0)},{default:c(()=>[o("img",{src:a(ee),alt:e.$t("field_remove_block")},null,8,ye)]),_:1})])):r("",!0)])):r("",!0),(g=e.issue.blocked_by_issues)!=null&&g.length?(t(),i("div",Ce,[(t(!0),i(X,null,q(e.issue.blocked_by_issues,(l,H)=>(t(),i("div",{key:H,class:"modal-issue__header__issue-blocked"},[o("a",{class:"fz-12",href:`/issues/${l.id}`,target:"_blank"}," #"+n(l.id)+"  ",9,we),o("span",null,n(l.subject),1)]))),128))])):r("",!0),(t(),d(G,{to:"body"},[p(a(A),{visibility:b.value,title:`${e.$t("field_remove_block")}?`,"confirm-label":e.$t("button_unlock"),"cancel-label":e.$t("button_cancel"),onCancel:s[7]||(s[7]=l=>b.value=!1),onConfirm:M},null,8,["visibility","title","confirm-label","cancel-label"])]))])):r("",!0)}}});export{Be as _};
