import{u as U,a3 as T,r as V,D as E,y as M,a0 as D,a4 as F,H,e as t,o as d,k as _,F as k,l as B,d as y,w as S,c as O,s as A,t as N,a5 as j,m as z,a6 as L}from"./ModalsView.js";import{K as I}from"./vuedraggable.umd.js";import{_ as K}from"./IssuiesBoardItem.vue_vue_type_script_setup_true_lang.js";/* empty css                          */import"./FormatDates.js";import"./ChipPrimitive.vue_vue_type_script_setup_true_lang.js";const P={group:"group",forceFallback:!0,fallbackOnBody:!0,animation:200,easing:"cubic-bezier(1, 0, 0, 1)",itemKey:"id"};function q(){const c=U();async function r(n,g){try{await c.updateIssueStatus({issue_id:n.id,status_id:g,updated_on:n.updated_on})}catch(f){console.error(f)}}async function p(n,g,f){var u;const{element:h}=n.moved,b={issue_id:h.id,after_id:((u=f[n.moved.newIndex-1])==null?void 0:u.id)??null,status_id:g,updated_on:h.updated_on};c.preUpdateIssueOrder(b);try{await c.updateIssueOrder(b)}catch(C){console.error(C)}}function l(n){return c.hiddenColumns.includes(n)}return{boardOptions:P,issueStatusChange:r,issueOrderChange:p,isColumnHidden:l}}function G(){const c=T("appVersion"),r=V(),p=E();function l(n){c!=="free"&&(r.value=`/issues/context_menu?ids[]=${n.id}&authenticity_token=${p.token}`)}return{contextMenuUrl:r,onEditThroughtContext:l}}const J={key:0,class:"issuesboard-list"},Q={key:1,class:"issuesboard-board__substatuses"},R={key:1,class:"issuesboard-list__hidden-column"},ne=M({__name:"BoardClassicView",setup(c){const r=U(),p=D(),{boardOptions:l,isColumnHidden:n,issueStatusChange:g,issueOrderChange:f}=q(),{contextMenuUrl:h,onEditThroughtContext:b}=G(),u=V(!1);l.onEnd=()=>{F(100).then(()=>{u.value=!1})};const C=H(()=>r.filteredIssues.reduce((o,e)=>{const i=e.status.id.toString();return o[i]||(o[i]=[]),o[i].push(e),o},{}));function x(o,e){!o.moved||r.boardViewType!==L||!e||f(o,e,C.value[e])}function w(o,e){var a,v;const i=((v=(a=o.item)==null?void 0:a.__draggable_context)==null?void 0:v.element)??null;!e||!i||g(i,e)}return(o,e)=>{var i;return(i=t(p).settings)!=null&&i.statuses?(d(),_("div",J,[(d(!0),_(k,null,B(t(p).settings.statuses,(a,v)=>(d(),_("div",{key:v,class:"issuesboard-list--wrapper"},[y(j,{name:t(n)(a.name)?"column-hide":"column-show",mode:"out-in"},{default:S(()=>[t(n)(a.name)?(d(),_("div",R,N(a.name),1)):(d(),_(k,{key:0},[a.is_group?(d(),_("div",Q,[(d(!0),_(k,null,B(a.substatuses,(s,$)=>(d(),O(t(I),A(t(l),{key:s.id||`board__${$}`,list:s.id?C.value[s.id]:[],tag:"form","data-cm-url":t(h),class:"issuesboard-board issuesboard-board__substatus issuesboard-list__item",onStart:e[1]||(e[1]=m=>u.value=!0),onChange:m=>x(m,s.id),onAdd:m=>w(m,s.id)}),{item:S(({element:m})=>[y(K,{"item-data":m,"checked-users":t(r).assignedCheckedUsers,"is-drag-active":u.value,onContextmenu:W=>t(b)(m)},null,8,["item-data","checked-users","is-drag-active","onContextmenu"])]),_:2},1040,["list","data-cm-url","onChange","onAdd"]))),128))])):(d(),O(t(I),A({key:0},t(l),{tag:"form","data-cm-url":t(h),list:a.id?C.value[a.id]:[],class:"issuesboard-board issuesboard-list__item",onStart:e[0]||(e[0]=s=>u.value=!0),onChange:s=>x(s,a.id),onAdd:s=>w(s,a.id)}),{item:S(({element:s})=>[y(K,{"item-data":s,"checked-users":t(r).assignedCheckedUsers,"is-drag-active":u.value,onContextmenu:$=>t(b)(s)},null,8,["item-data","checked-users","is-drag-active","onContextmenu"])]),_:2},1040,["data-cm-url","list","onChange","onAdd"]))],64))]),_:2},1032,["name"])]))),128))])):z("",!0)}}});export{ne as default};
